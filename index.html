<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Quality Monitoring Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0f1a;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 150, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 200, 150, 0.15) 0%, transparent 50%);
            z-index: -2;
        }

        .water-bg {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(to top, rgba(0, 100, 200, 0.1), transparent);
            z-index: -1;
        }

        .bubble {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), rgba(0, 150, 255, 0.1));
            animation: rise 8s infinite ease-in;
            z-index: -1;
        }

        .bubble:nth-child(1) { width: 40px; height: 40px; left: 10%; animation-duration: 8s; animation-delay: 0s; }
        .bubble:nth-child(2) { width: 20px; height: 20px; left: 20%; animation-duration: 6s; animation-delay: 1s; }
        .bubble:nth-child(3) { width: 35px; height: 35px; left: 35%; animation-duration: 10s; animation-delay: 2s; }
        .bubble:nth-child(4) { width: 25px; height: 25px; left: 50%; animation-duration: 7s; animation-delay: 0.5s; }
        .bubble:nth-child(5) { width: 30px; height: 30px; left: 65%; animation-duration: 9s; animation-delay: 1.5s; }
        .bubble:nth-child(6) { width: 45px; height: 45px; left: 80%; animation-duration: 11s; animation-delay: 3s; }
        .bubble:nth-child(7) { width: 15px; height: 15px; left: 90%; animation-duration: 5s; animation-delay: 2.5s; }

        @keyframes rise {
            0% { bottom: -50px; opacity: 0; transform: translateX(0) scale(1); }
            10% { opacity: 0.6; }
            50% { opacity: 0.4; transform: translateX(20px) scale(1.1); }
            100% { bottom: 100%; opacity: 0; transform: translateX(-20px) scale(0.8); }
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .header {
            border-radius: 24px;
            padding: 25px 35px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header h1 {
            color: #ffffff;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-badge {
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse-glow 2s infinite;
        }

        .status-clean {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 200, 100, 0.1));
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .status-slightly-dirty {
            background: linear-gradient(135deg, rgba(255, 200, 0, 0.2), rgba(255, 150, 0, 0.1));
            color: #ffc800;
            border: 1px solid rgba(255, 200, 0, 0.3);
        }

        .status-dirty {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.2), rgba(255, 100, 0, 0.1));
            color: #ff8c00;
            border: 1px solid rgba(255, 140, 0, 0.3);
        }

        .status-critical {
            background: linear-gradient(135deg, rgba(255, 50, 50, 0.2), rgba(255, 0, 0, 0.1));
            color: #ff3232;
            border: 1px solid rgba(255, 50, 50, 0.3);
            animation: critical-pulse 1s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor; }
        }

        @keyframes critical-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        .led-panel {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .led {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            position: relative;
        }

        .led::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
        }

        .led-green {
            background: radial-gradient(circle at 30% 30%, #00ff88, #00aa55);
            box-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88, 0 0 30px #00ff88;
        }

        .led-yellow {
            background: radial-gradient(circle at 30% 30%, #ffcc00, #ff9900);
            box-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00, 0 0 30px #ffcc00;
        }

        .led-red {
            background: radial-gradient(circle at 30% 30%, #ff4444, #cc0000);
            box-shadow: 0 0 10px #ff4444, 0 0 20px #ff4444, 0 0 30px #ff4444;
            animation: blink 0.5s infinite;
        }

        .led-off {
            background: radial-gradient(circle at 30% 30%, #333, #222);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .led-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .params-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .param-card {
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }

        .param-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), transparent);
        }

        .param-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .param-title {
            color: rgba(255,255,255,0.7);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .param-icon {
            font-size: 1.5rem;
        }

        .param-value {
            font-size: 2.8rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 5px;
        }

        .param-unit {
            font-size: 1rem;
            color: rgba(255,255,255,0.5);
            font-weight: 400;
        }

        .param-status {
            font-size: 0.8rem;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 15px;
        }

        .status-good {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
        }

        .status-warning {
            background: rgba(255, 200, 0, 0.15);
            color: #ffc800;
        }

        .status-danger {
            background: rgba(255, 50, 50, 0.15);
            color: #ff3232;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease, background 0.5s ease;
        }

        /* Tank Visualization */
        .tank-panel {
            border-radius: 24px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tank-title {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .tank-container {
            width: 200px;
            height: 300px;
            position: relative;
            margin-bottom: 20px;
        }

        .tank {
            width: 100%;
            height: 100%;
            border: 4px solid rgba(255,255,255,0.2);
            border-radius: 10px 10px 30px 30px;
            position: relative;
            overflow: hidden;
            background: rgba(0,0,0,0.3);
        }

        .tank-water {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--water-color-dark), var(--water-color-light));
            transition: height 0.5s ease, background 0.5s ease;
            border-radius: 0 0 26px 26px;
        }

        .tank-water::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath fill='rgba(255,255,255,0.1)' d='M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z'/%3E%3C/svg%3E") repeat-x;
            animation: wave 3s infinite linear;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1200px; }
        }

        .tank-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(139, 90, 43, 0.6);
            border-radius: 50%;
            animation: float-particle 4s infinite ease-in-out;
        }

        @keyframes float-particle {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-10px) translateX(5px); }
            50% { transform: translateY(-5px) translateX(-5px); }
            75% { transform: translateY(-15px) translateX(3px); }
        }

        .tank-level {
            position: absolute;
            right: -50px;
            top: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px 0;
        }

        .tank-level span {
            color: rgba(255,255,255,0.4);
            font-size: 0.7rem;
        }

        .tank-info {
            text-align: center;
        }

        .tank-info h3 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .tank-info p {
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
        }

        /* Dirtiness Index */
        .dirtiness-section {
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            color: #fff;
            font-size: 1.3rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dirtiness-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .dirtiness-container {
                grid-template-columns: 1fr;
            }
        }

        .gauge-container {
            position: relative;
            width: 250px;
            height: 150px;
            margin: 0 auto;
        }

        .gauge {
            width: 100%;
            height: 100%;
        }

        .gauge-bg {
            fill: none;
            stroke: rgba(255,255,255,0.1);
            stroke-width: 20;
        }

        .gauge-fill {
            fill: none;
            stroke-width: 20;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease, stroke 0.5s ease;
        }

        .gauge-value {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .gauge-value .number {
            font-size: 3rem;
            font-weight: 700;
            color: #fff;
        }

        .gauge-value .label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        .dirtiness-details {
            display: grid;
            gap: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
        }

        .detail-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        .detail-value {
            font-weight: 600;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        /* Alerts Section */
        .alerts-section {
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .alert-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            border-left: 4px solid;
        }

        .alert-item.alert-success {
            border-color: #00ff88;
        }

        .alert-item.alert-warning {
            border-color: #ffc800;
        }

        .alert-item.alert-danger {
            border-color: #ff3232;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            color: #fff;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .alert-message {
            color: rgba(255,255,255,0.6);
            font-size: 0.85rem;
        }

        .alert-time {
            color: rgba(255,255,255,0.4);
            font-size: 0.75rem;
        }

        /* Controls */
        .controls-section {
            border-radius: 24px;
            padding: 30px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0088ff 0%, #00d4ff 100%);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(0, 136, 255, 0.5);
        }

        .btn-success {
            background: linear-gradient(135deg, #00cc66 0%, #00ff88 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9900 0%, #ffcc00 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
        }

        /* Threshold Settings Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(20, 25, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 24px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .modal-header h2 {
            color: #ffffff;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .params-grid {
                grid-template-columns: 1fr;
            }

            .param-value {
                font-size: 2rem;
            }
        }

        /* Animation for data update */
        .updating {
            animation: data-flash 0.5s ease;
        }

        @keyframes data-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="water-bg"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>

    <div class="container">
        <!-- Header -->
        <div class="header glass">
            <div class="header-left">
                <h1>üíß Water Quality Monitor</h1>
                <div class="status-badge status-clean" id="mainStatus">
                    <span>‚óè</span>
                    <span id="statusText">CLEAN</span>
                </div>
            </div>
            <div class="led-panel">
                <div class="led-label">Status LEDs</div>
                <div class="led led-green" id="ledGreen" title="Safe"></div>
                <div class="led led-off" id="ledYellow" title="Degrading"></div>
                <div class="led led-off" id="ledRed" title="Critical"></div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Parameters Grid -->
            <div class="params-grid">
                <!-- TDS -->
                <div class="param-card glass" style="--accent-color: #00ff88;">
                    <div class="param-header">
                        <div class="param-title">TDS Level</div>
                        <div class="param-icon">‚öóÔ∏è</div>
                    </div>
                    <div class="param-value"><span id="tdsValue">250</span><span class="param-unit"> ppm</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="tdsBar" style="width: 25%; background: linear-gradient(90deg, #00ff88, #00d4ff);"></div>
                    </div>
                    <span class="param-status status-good" id="tdsStatus">Safe</span>
                </div>

                <!-- pH -->
                <div class="param-card glass" style="--accent-color: #a855f7;">
                    <div class="param-header">
                        <div class="param-title">pH Value</div>
                        <div class="param-icon">üß™</div>
                    </div>
                    <div class="param-value"><span id="phValue">7.2</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="phBar" style="width: 51%; background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77);"></div>
                    </div>
                    <span class="param-status status-good" id="phStatus">Neutral</span>
                </div>

                <!-- Stagnation Time -->
                <div class="param-card glass" style="--accent-color: #ffc800;">
                    <div class="param-header">
                        <div class="param-title">Stagnation Time</div>
                        <div class="param-icon">‚è±Ô∏è</div>
                    </div>
                    <div class="param-value"><span id="stagnationValue">2</span><span class="param-unit"> Days</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="stagnationBar" style="width: 20%; background: linear-gradient(90deg, #00ff88, #ffc800);"></div>
                    </div>
                    <span class="param-status status-good" id="stagnationStatus">Fresh</span>
                </div>
            </div>

            <!-- Tank Panel -->
            <div class="tank-panel glass">
                <div class="tank-title">Water Tank</div>
                <div class="tank-container">
                    <div class="tank">
                        <div class="tank-water" id="tankWater" style="height: 75%; --water-color-dark: rgba(0, 150, 255, 0.8); --water-color-light: rgba(0, 200, 255, 0.4);">
                            <div class="tank-particles" id="particlesContainer"></div>
                        </div>
                    </div>
                    <div class="tank-level">
                        <span>100%</span>
                        <span>75%</span>
                        <span>50%</span>
                        <span>25%</span>
                        <span>0%</span>
                    </div>
                </div>
                <div class="tank-info">
                    <h3 id="tankLevel">75%</h3>
                    <p>Water Level</p>
                </div>
            </div>
        </div>

        <!-- Dirtiness Index Section -->
        <div class="dirtiness-section glass">
            <div class="section-title">üìä Dirtiness Index Analysis</div>
            <div class="dirtiness-container">
                <div class="gauge-container">
                    <svg class="gauge" viewBox="0 0 200 120">
                        <path class="gauge-bg" d="M 20 100 A 80 80 0 0 1 180 100"></path>
                        <path class="gauge-fill" id="gaugeFill" d="M 20 100 A 80 80 0 0 1 180 100" 
                              stroke="url(#gaugeGradient)"
                              stroke-dasharray="251.2"
                              stroke-dashoffset="200"></path>
                        <defs>
                            <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#00ff88"/>
                                <stop offset="50%" stop-color="#ffc800"/>
                                <stop offset="100%" stop-color="#ff3232"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <div class="gauge-value">
                        <div class="number" id="dirtinessValue">18</div>
                        <div class="label">/ 100</div>
                    </div>
                </div>
                <div class="dirtiness-details">
                    <div class="detail-row">
                        <span class="detail-label">Overall Rating</span>
                        <span class="detail-value status-good" id="ratingBadge">LOW</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">TDS Contribution</span>
                        <span class="detail-value" id="tdsContrib">25%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">pH Deviation</span>
                        <span class="detail-value" id="phContrib">5%</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Stagnation Factor</span>
                        <span class="detail-value" id="stagContrib">20%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="alerts-section glass">
            <div class="section-title">üîî System Alerts</div>
            <div class="alert-list" id="alertsList">
                <div class="alert-item alert-success">
                    <div class="alert-icon">‚úÖ</div>
                    <div class="alert-content">
                        <div class="alert-title">Water Quality Normal</div>
                        <div class="alert-message">All parameters are within acceptable limits</div>
                    </div>
                    <div class="alert-time">Just now</div>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section glass">
            <div class="section-title">‚öôÔ∏è Controls</div>
            <div class="controls-grid">
                <button class="btn btn-primary" onclick="refreshData()">
                    üîÑ Refresh Data
                </button>
                <button class="btn btn-success" onclick="simulateClean()">
                    ‚ú® Simulate Clean Water
                </button>
                <button class="btn btn-warning" onclick="simulateDirty()">
                    üí® Simulate Dirty Water
                </button>
                <button class="btn btn-danger" onclick="simulateCritical()">
                    ‚ö†Ô∏è Simulate Critical
                </button>
                <button class="btn btn-primary" onclick="openSettings()">
                    ‚öôÔ∏è Threshold Settings
                </button>
                <button class="btn btn-primary" onclick="toggleAutoUpdate()">
                    <span id="autoUpdateIcon">‚ñ∂Ô∏è</span> Auto Update: <span id="autoUpdateStatus">OFF</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Threshold Settings</h2>
            </div>
            <form id="settingsForm">
                <div class="form-group">
                    <label>TDS Threshold (ppm)</label>
                    <div class="form-row">
                        <input type="number" id="tdsWarn" value="500" placeholder="Warning">
                        <input type="number" id="tdsCrit" value="1000" placeholder="Critical">
                    </div>
                </div>
                <div class="form-group">
                    <label>pH Range (Optimal: 6.5 - 8.5)</label>
                    <div class="form-row">
                        <input type="number" id="phMin" value="6.5" step="0.1" placeholder="Min">
                        <input type="number" id="phMax" value="8.5" step="0.1" placeholder="Max">
                    </div>
                </div>
                <div class="form-group">
                    <label>Stagnation Warning (Days)</label>
                    <div class="form-row">
                        <input type="number" id="stagWarn" value="5" placeholder="Warning">
                        <input type="number" id="stagCrit" value="10" placeholder="Critical">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="closeSettings()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Settings</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuration & Thresholds (Turbidity removed)
        let thresholds = {
            tds: { warn: 500, crit: 1000 },
            ph: { min: 6.5, max: 8.5 },
            stagnation: { warn: 5, crit: 10 }
        };

        // Current sensor values (Turbidity removed)
        let sensorData = {
            tds: 250,
            ph: 7.2,
            stagnation: 2,
            tankLevel: 75
        };

        let autoUpdateInterval = null;
        let isAutoUpdate = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            createParticles(5);
        });

        // Create floating particles in tank
        function createParticles(count) {
            const container = document.getElementById('particlesContainer');
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 90 + 5 + '%';
                particle.style.top = Math.random() * 80 + 10 + '%';
                particle.style.animationDelay = Math.random() * 4 + 's';
                particle.style.animationDuration = (3 + Math.random() * 3) + 's';
                container.appendChild(particle);
            }
        }

        // Calculate dirtiness index (Updated weights without Turbidity)
        function calculateDirtinessIndex() {
            // TDS contribution (0-40 points)
            let tdsScore = Math.min(40, (sensorData.tds / thresholds.tds.crit) * 40);
            
            // pH deviation (0-25 points)
            let phIdeal = 7.0;
            let phDeviation = Math.abs(sensorData.ph - phIdeal);
            let phScore = Math.min(25, phDeviation * 8);
            
            // Stagnation contribution (0-35 points)
            let stagScore = Math.min(35, (sensorData.stagnation / thresholds.stagnation.crit) * 35);
            
            let total = Math.round(tdsScore + phScore + stagScore);
            
            return {
                total: Math.min(100, total),
                tds: Math.round(tdsScore),
                ph: Math.round(phScore),
                stagnation: Math.round(stagScore)
            };
        }

        // Get water quality status
        function getWaterStatus(dirtinessIndex) {
            if (dirtinessIndex <= 20) return { status: 'Clean', class: 'status-clean', led: 'green' };
            if (dirtinessIndex <= 45) return { status: 'Slightly Dirty', class: 'status-slightly-dirty', led: 'yellow' };
            if (dirtinessIndex <= 70) return { status: 'Dirty', class: 'status-dirty', led: 'yellow' };
            return { status: 'Critical ‚Äì Cleaning Required', class: 'status-critical', led: 'red' };
        }

        // Update all displays
        function updateDisplay() {
            // Update parameter values
            document.getElementById('tdsValue').textContent = sensorData.tds;
            document.getElementById('phValue').textContent = sensorData.ph.toFixed(1);
            document.getElementById('stagnationValue').textContent = sensorData.stagnation;
            document.getElementById('tankLevel').textContent = sensorData.tankLevel + '%';

            // Update progress bars
            updateProgressBar('tdsBar', sensorData.tds, 1500, thresholds.tds);
            updateProgressBar('stagnationBar', sensorData.stagnation, 15, thresholds.stagnation);

            // pH bar (centered scale)
            const phPercent = ((sensorData.ph - 0) / 14) * 100;
            document.getElementById('phBar').style.width = phPercent + '%';

            // Update parameter statuses
            updateParamStatus('tdsStatus', sensorData.tds, thresholds.tds,
                ['Safe', 'Elevated', 'Critical']);
            updateParamStatus('stagnationStatus', sensorData.stagnation, thresholds.stagnation,
                ['Fresh', 'Aging', 'Stale']);

            // pH status
            const phStatus = document.getElementById('phStatus');
            if (sensorData.ph < thresholds.ph.min) {
                phStatus.textContent = 'Acidic';
                phStatus.className = 'param-status status-warning';
            } else if (sensorData.ph > thresholds.ph.max) {
                phStatus.textContent = 'Alkaline';
                phStatus.className = 'param-status status-warning';
            } else {
                phStatus.textContent = 'Neutral';
                phStatus.className = 'param-status status-good';
            }

            // Calculate and display dirtiness index
            const dirtiness = calculateDirtinessIndex();
            const waterStatus = getWaterStatus(dirtiness.total);

            document.getElementById('dirtinessValue').textContent = dirtiness.total;
            document.getElementById('tdsContrib').textContent = dirtiness.tds + '%';
            document.getElementById('phContrib').textContent = dirtiness.ph + '%';
            document.getElementById('stagContrib').textContent = dirtiness.stagnation + '%';

            // Update gauge
            const gaugeOffset = 251.2 - (dirtiness.total / 100 * 251.2);
            document.getElementById('gaugeFill').style.strokeDashoffset = gaugeOffset;

            // Update rating badge
            const ratingBadge = document.getElementById('ratingBadge');
            if (dirtiness.total <= 25) {
                ratingBadge.textContent = 'LOW';
                ratingBadge.className = 'detail-value status-good';
            } else if (dirtiness.total <= 50) {
                ratingBadge.textContent = 'MEDIUM';
                ratingBadge.className = 'detail-value status-warning';
            } else {
                ratingBadge.textContent = 'HIGH';
                ratingBadge.className = 'detail-value status-danger';
            }

            // Update main status
            const mainStatus = document.getElementById('mainStatus');
            mainStatus.className = 'status-badge ' + waterStatus.class;
            document.getElementById('statusText').textContent = waterStatus.status.toUpperCase();

            // Update LEDs
            updateLEDs(waterStatus.led);

            // Update tank visualization
            updateTank();

            // Update alerts
            updateAlerts(dirtiness.total, waterStatus.status);
        }

        function updateProgressBar(id, value, max, thresholds) {
            const bar = document.getElementById(id);
            const percent = Math.min(100, (value / max) * 100);
            bar.style.width = percent + '%';

            if (value >= thresholds.crit) {
                bar.style.background = 'linear-gradient(90deg, #ff3232, #ff6666)';
            } else if (value >= thresholds.warn) {
                bar.style.background = 'linear-gradient(90deg, #ffc800, #ff9900)';
            } else {
                bar.style.background = 'linear-gradient(90deg, #00ff88, #00d4ff)';
            }
        }

        function updateParamStatus(id, value, thresholds, labels) {
            const status = document.getElementById(id);
            if (value >= thresholds.crit) {
                status.textContent = labels[2];
                status.className = 'param-status status-danger';
            } else if (value >= thresholds.warn) {
                status.textContent = labels[1];
                status.className = 'param-status status-warning';
            } else {
                status.textContent = labels[0];
                status.className = 'param-status status-good';
            }
        }

        function updateLEDs(activeColor) {
            const ledGreen = document.getElementById('ledGreen');
            const ledYellow = document.getElementById('ledYellow');
            const ledRed = document.getElementById('ledRed');

            // Reset all
            ledGreen.className = 'led led-off';
            ledYellow.className = 'led led-off';
            ledRed.className = 'led led-off';

            // Activate appropriate LED
            if (activeColor === 'green') {
                ledGreen.className = 'led led-green';
            } else if (activeColor === 'yellow') {
                ledYellow.className = 'led led-yellow';
            } else if (activeColor === 'red') {
                ledRed.className = 'led led-red';
            }
        }

        function updateTank() {
            const tankWater = document.getElementById('tankWater');
            const dirtiness = calculateDirtinessIndex().total;

            tankWater.style.height = sensorData.tankLevel + '%';

            // Change water color based on dirtiness
            if (dirtiness <= 20) {
                tankWater.style.setProperty('--water-color-dark', 'rgba(0, 150, 255, 0.8)');
                tankWater.style.setProperty('--water-color-light', 'rgba(0, 200, 255, 0.4)');
                createParticles(3);
            } else if (dirtiness <= 45) {
                tankWater.style.setProperty('--water-color-dark', 'rgba(100, 180, 150, 0.8)');
                tankWater.style.setProperty('--water-color-light', 'rgba(150, 200, 100, 0.4)');
                createParticles(8);
            } else if (dirtiness <= 70) {
                tankWater.style.setProperty('--water-color-dark', 'rgba(180, 150, 80, 0.8)');
                tankWater.style.setProperty('--water-color-light', 'rgba(200, 180, 100, 0.4)');
                createParticles(15);
            } else {
                tankWater.style.setProperty('--water-color-dark', 'rgba(139, 90, 43, 0.9)');
                tankWater.style.setProperty('--water-color-light', 'rgba(160, 100, 50, 0.5)');
                createParticles(25);
            }
        }

        function updateAlerts(dirtiness, status) {
            const alertsList = document.getElementById('alertsList');
            let alerts = [];

            if (dirtiness > 70) {
                alerts.push({
                    type: 'danger',
                    icon: 'üö®',
                    title: 'CRITICAL: Immediate Action Required',
                    message: 'Water quality has degraded to critical levels. Clean tank immediately!'
                });
            }

            if (sensorData.tds >= thresholds.tds.crit) {
                alerts.push({
                    type: 'danger',
                    icon: '‚ö†Ô∏è',
                    title: 'High TDS Level',
                    message: `TDS at ${sensorData.tds} ppm indicates significant contamination`
                });
            } else if (sensorData.tds >= thresholds.tds.warn) {
                alerts.push({
                    type: 'warning',
                    icon: '‚ö°',
                    title: 'TDS Warning',
                    message: `TDS at ${sensorData.tds} ppm - monitor closely`
                });
            }

            if (sensorData.stagnation >= thresholds.stagnation.crit) {
                alerts.push({
                    type: 'danger',
                    icon: '‚è∞',
                    title: 'Water Stagnation Critical',
                    message: `Water has been stagnant for ${sensorData.stagnation} days - replace immediately`
                });
            } else if (sensorData.stagnation >= thresholds.stagnation.warn) {
                alerts.push({
                    type: 'warning',
                    icon: '‚è±Ô∏è',
                    title: 'Stagnation Warning',
                    message: `Water stagnant for ${sensorData.stagnation} days - consider refreshing`
                });
            }

            if (sensorData.ph < thresholds.ph.min || sensorData.ph > thresholds.ph.max) {
                alerts.push({
                    type: 'warning',
                    icon: 'üß™',
                    title: 'pH Out of Range',
                    message: `pH at ${sensorData.ph} is outside optimal range (${thresholds.ph.min}-${thresholds.ph.max})`
                });
            }

            if (alerts.length === 0) {
                alerts.push({
                    type: 'success',
                    icon: '‚úÖ',
                    title: 'Water Quality Normal',
                    message: 'All parameters are within acceptable limits'
                });
            }

            alertsList.innerHTML = alerts.map(alert => `
                <div class="alert-item alert-${alert.type}">
                    <div class="alert-icon">${alert.icon}</div>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-message">${alert.message}</div>
                    </div>
                    <div class="alert-time">Just now</div>
                </div>
            `).join('');
        }

        // Simulation functions
        function simulateClean() {
            sensorData = {
                tds: Math.floor(Math.random() * 200) + 100,
                ph: (Math.random() * 0.8 + 6.8).toFixed(1) * 1,
                stagnation: Math.floor(Math.random() * 2),
                tankLevel: Math.floor(Math.random() * 20) + 75
            };
            animateUpdate();
        }

        function simulateDirty() {
            sensorData = {
                tds: Math.floor(Math.random() * 400) + 400,
                ph: (Math.random() * 1.5 + 5.5).toFixed(1) * 1,
                stagnation: Math.floor(Math.random() * 4) + 5,
                tankLevel: Math.floor(Math.random() * 30) + 40
            };
            animateUpdate();
        }

        function simulateCritical() {
            sensorData = {
                tds: Math.floor(Math.random() * 500) + 800,
                ph: (Math.random() * 2 + 4.5).toFixed(1) * 1,
                stagnation: Math.floor(Math.random() * 5) + 10,
                tankLevel: Math.floor(Math.random() * 20) + 20
            };
            animateUpdate();
        }

        function refreshData() {
            // Simulate random fluctuations
            sensorData.tds = Math.max(0, sensorData.tds + (Math.random() * 50 - 25));
            sensorData.ph = Math.max(0, Math.min(14, sensorData.ph + (Math.random() * 0.4 - 0.2)));
            
            // Round values
            sensorData.tds = Math.round(sensorData.tds);
            sensorData.ph = Math.round(sensorData.ph * 10) / 10;
            
            animateUpdate();
        }

        function animateUpdate() {
            document.querySelectorAll('.param-value, .gauge-value .number').forEach(el => {
                el.classList.add('updating');
                setTimeout(() => el.classList.remove('updating'), 500);
            });
            updateDisplay();
        }

        function toggleAutoUpdate() {
            isAutoUpdate = !isAutoUpdate;
            document.getElementById('autoUpdateStatus').textContent = isAutoUpdate ? 'ON' : 'OFF';
            document.getElementById('autoUpdateIcon').textContent = isAutoUpdate ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';

            if (isAutoUpdate) {
                autoUpdateInterval = setInterval(refreshData, 3000);
            } else {
                clearInterval(autoUpdateInterval);
            }
        }

        // Settings modal
        function openSettings() {
            document.getElementById('tdsWarn').value = thresholds.tds.warn;
            document.getElementById('tdsCrit').value = thresholds.tds.crit;
            document.getElementById('phMin').value = thresholds.ph.min;
            document.getElementById('phMax').value = thresholds.ph.max;
            document.getElementById('stagWarn').value = thresholds.stagnation.warn;
            document.getElementById('stagCrit').value = thresholds.stagnation.crit;
            document.getElementById('settingsModal').classList.add('show');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        document.getElementById('settingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            thresholds.tds.warn = parseFloat(document.getElementById('tdsWarn').value);
            thresholds.tds.crit = parseFloat(document.getElementById('tdsCrit').value);
            thresholds.ph.min = parseFloat(document.getElementById('phMin').value);
            thresholds.ph.max = parseFloat(document.getElementById('phMax').value);
            thresholds.stagnation.warn = parseFloat(document.getElementById('stagWarn').value);
            thresholds.stagnation.crit = parseFloat(document.getElementById('stagCrit').value);
            closeSettings();
            updateDisplay();
        });

        // Close modal on outside click
        window.onclick = (e) => {
            if (e.target.id === 'settingsModal') closeSettings();
        };
    </script>
</body>
</html>
